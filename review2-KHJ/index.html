<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>후기 게시판</title>

    <link rel="stylesheet" href="../_common/header_footer_style.css" />
    <script src="../_common/header_footer_script.js"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD"
      crossorigin="anonymous"
    />
    <style>
      /* 추가적인 스타일링 */
      .review-container {
        padding: 20px;
      }

      .review-title {
        font-size: 24px;
        font-weight: bold;
        margin-bottom: 10px;
      }

      .review-content {
        margin-bottom: 20px;
      }

      .review-author {
        font-style: italic;
        margin-bottom: 10px;
      }

      .review-date {
        color: #888;
      }

      /* Carousel 스타일 */
      .carousel-container {
        margin-bottom: 20px;
      }

      .carousel-image {
        width: 100%;
        height: auto;
        max-height: 500px; /* Carousel 최대 높이 설정 */
        object-fit: cover; /* 이미지가 Carousel에 맞춰 잘리도록 설정 */
      }

      /* 댓글 스타일 */
      .comment {
        margin-bottom: 10px;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
      }

      .comment-author {
        font-weight: bold;
        margin-bottom: 5px;
      }

      .comment-content {
        white-space: pre-wrap; /* 댓글 내용이 여러 줄로 표시되도록 설정 */
      }

      /* 댓글창 스타일 */
      .comment-form textarea {
        resize: vertical; /* 댓글창 높이 조절 가능하도록 설정 */
      }
    </style>
  </head>

  <body>
    <div class="container">
      <nav id="header"></nav>
      <div class="container review-container">
        <div class="row">
          <div class="col-md-8 offset-md-2">
            <div class="carousel-container">
              <div
                id="reviewCarousel"
                class="carousel slide"
                data-bs-ride="carousel"
              >
                <div class="carousel-inner">
                  <div class="carousel-item active">
                    <img
                      src="image1.jpg"
                      class="d-block w-100 carousel-image"
                      alt="Image 1"
                    />
                  </div>
                  <div class="carousel-item">
                    <img
                      src="https://search.pstatic.net/common/?src=http%3A%2F%2Fblogfiles.naver.net%2FMjAyNDExMjRfMTU5%2FMDAxNzMyNDMyMzgzOTQ0.2kEggzBeMxTUaRXNPByjLqZFohehSAp8nrc9tKKIkmcg.5kPe8-rIy5ZHtUZV_tajEOZg6wsdOaTTaybReYjhYR0g.JPEG%2F900%25A3%25DFScreenshot%25A3%25DF20241124%25A3%25DF161211.jpg&type=sc960_832"
                      class="d-block w-100 carousel-image"
                      alt="Image 2"
                    />
                  </div>
                  <div class="carousel-item">
                    <img
                      src="image3.jpg"
                      class="d-block w-100 carousel-image"
                      alt="Image 3"
                    />
                  </div>
                </div>
              </div>
            </div>
            <div class="review-title" id="review-title">후기 제목</div>
            <div class="review-content" id="review-content">후기 내용</div>
            <div class="review-author" id="review-author">작성자</div>
            <div class="review-date" id="review-date">작성일</div>

            <div class="mt-4">
              <h4 class="mb-3">댓글</h4>
              <div id="comments-container"></div>
              <form class="mt-3 comment-form">
                <textarea
                  placeholder="댓글을 작성하세요"
                  rows="4"
                  class="w-100 px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-gray-200"
                ></textarea>
                <button
                  class="mt-2 py-2 px-4 bg-black text-white rounded hover:bg-gray-800 transition-colors"
                >
                  Submit
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>
      <footer id="footer"></footer>
    </div>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN"
      crossorigin="anonymous"
    ></script>
    <script>
      // URL에서 후기 ID 추출
      const urlParams = new URLSearchParams(window.location.search);
      const reviewId = urlParams.get("id");

      // 후기 데이터 가져오기 (예시)
      const reviews = {
        1: {
          title: "정말 좋았어요!",
          content:
            "이 제품은 정말 맘에 들어요. 배송도 빠르고 품질도 좋아요. 강력 추천합니다!",
          author: "user1",
          date: "2024-05-15",
          comments: [
            {
              author: "user2",
              content: "저도 공감해요! 정말 좋은 제품이에요.",
            },
            {
              author: "user3",
              content: "저도 써봤는데, 가격 대비 성능 최고인 것 같아요!",
            },
          ],
        },
        2: {
          title: "아쉬운 점도 있지만...",
          content:
            "디자인은 예쁜데, 성능이 조금 아쉽네요. 그래도 가격 대비 괜찮은 것 같아요.",
          author: "user2",
          date: "2024-05-10",
          comments: [],
        },
        // ... 추가적인 후기 데이터
      };

      // 후기 ID에 해당하는 데이터 표시
      if (reviewId && reviews[reviewId]) {
        const review = reviews[reviewId];
        document.getElementById("review-title").textContent = review.title;
        document.getElementById("review-content").textContent = review.content;
        document.getElementById("review-author").textContent = review.author;
        document.getElementById("review-date").textContent = review.date;

        // 댓글 표시
        const commentsContainer = document.getElementById("comments-container");
        review.comments.forEach((comment) => {
          addCommentToPage(comment); // 댓글을 페이지에 추가하는 함수 호출
        });
      } else {
        // 후기 데이터가 없을 경우 예외 처리
        document.getElementById("review-title").textContent = "후기 없음";
        document.getElementById("review-content").textContent =
          "해당 후기를 찾을 수 없습니다.";
      }

      // Carousel 자동 넘기기
      const carousel = new bootstrap.Carousel(
        document.getElementById("reviewCarousel"),
        {
          interval: 3000,
        }
      );

      // 댓글 작성 기능
      const commentForm = document.querySelector(".comment-form");
      commentForm.addEventListener("submit", (event) => {
        event.preventDefault();
        const commentText = commentForm.querySelector("textarea").value;
        const userId = "사용자ID"; // 임시 사용자 ID (실제로는 로그인된 사용자 ID 사용)
        const newComment = {
          author: userId,
          content: commentText,
        };

        // 댓글 데이터에 추가 (예시)
        if (reviews[reviewId]) {
          reviews[reviewId].comments.push(newComment);
          addCommentToPage(newComment); // 페이지에 댓글 추가
        }

        commentForm.reset();
      });

      // 댓글을 페이지에 추가하는 함수
      function addCommentToPage(comment) {
        const commentsContainer = document.getElementById("comments-container");
        const commentDiv = document.createElement("div");
        commentDiv.classList.add("comment");
        commentDiv.innerHTML = `
                <div class="comment-author">${comment.author}</div>
                <div class="comment-content">${comment.content}</div>
                <div class="comment-actions">
                    <button class="btn btn-sm btn-link comment-edit">수정</button>
                    <button class="btn btn-sm btn-link comment-delete">삭제</button>
                </div>
            `;
        commentsContainer.appendChild(commentDiv);

        // 댓글 수정 기능
        const editButton = commentDiv.querySelector(".comment-edit");
        editButton.addEventListener("click", () => {
          // 수정 기능 구현 (예: 댓글 내용 수정 폼 표시)
          alert("수정 기능 구현 예정");
        });

        // 댓글 삭제 기능
        const deleteButton = commentDiv.querySelector(".comment-delete");
        deleteButton.addEventListener("click", () => {
          // 삭제 기능 구현 (예: 댓글 데이터 삭제 후 화면 갱신)
          commentDiv.remove(); // 댓글 화면에서 삭제
        });
      }
    </script>
  </body>
</html>
